@model IEnumerable<frame.Models.Book>

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/SharedAdmin/_Layout.cshtml";
    var month = ViewBag.month;
    var year = ViewBag.year;
}
@{
    var sessionName = new Byte[20];
    bool ok = Context.Session.TryGetValue("login", out sessionName);
    string result = "";
    User users = null;
    if (ok)
    {
        result = System.Text.Encoding.UTF8.GetString(sessionName);
        users = Newtonsoft.Json.JsonConvert.DeserializeObject<User>(result);
    }
}
@if(users == null) {
    <h5 class="text-danger mt-5 d-flex justify-content-center">Bạn không có quyền vào trang này. Vui lòng <a class="text-light ml-1"href="../../Admin/AccountAdmin"> đăng nhập</a></h5>
} else {  
<div class="right_col" role="main" style="margin-left:14.4rem;;background-color:#F4F6F9;margin-top: -10px;">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <h1 class="m-0 text-dark">BÁO CAO TỒN KHO</h1>
            </div>
            <div class="row mb-3">
                <label class="mr-2 nb-4">Năm</label>
                <select name="year" id="chooseYear">
                    <option value="">--Chọn Năm--</option>
                    @foreach (var item in ViewBag.year)
                    {
                        <option value="@item">@item</option> 
                    }
                </select>
            </div>
            <div class="row mb-3">
                <label class="mr-2 nb-4">Tháng</label>
                <select name="month" id="chooseMonth">
                    <option value="">--Chọn Tháng--</option>
                    @* @foreach (var item in ViewBag.month)
                    {
                        <option value="@item">@item</option> 
                    } *@
                    <option value="01">Tháng 1</option>
                    <option value="02">Tháng 2</option>
                    <option value="03">Tháng 3</option>
                    <option value="04">Tháng 4</option>
                    <option value="05">Tháng 5</option>
                    <option value="06">Tháng 6</option>
                    <option value="07">Tháng 7</option>
                    <option value="08">Tháng 8</option>
                    <option value="09">Tháng 9</option>
                    <option value="10">Tháng 10</option>
                    <option value="11">Tháng 11</option>
                    <option value="12">Tháng 12</option>
                </select>
            </div>
            <input type="button" class="btn btn-primary btn-sm" onClick="getInventory()" value="Thống kê "/>
            <div id="show-inventory">
                
            </div>
        </div>
    </div>
</div>
}
<script>
    function getInventory(){
        var thang = $("#chooseMonth").val();
        var nam = $("#chooseYear").val();
        $.ajax({
            url: '/Admin/InventoryReports?month=' + thang + '&year=' + nam,
            type: 'GET',
            data: {month:thang, year:nam},
            success: function(data){
                var html = '<table class="table table-striped" style="text-align: center;margin: 3rem 5rem;width:67rem;border-bottom:1px;"><tHead><tr><th>Mã sách</th><th>Tên sách</th><th>Số lượng tồn đầu</th><th>Số lượng nhập</th><th>Số lượng bán</th><th>Số lượng tồn cuối</th></tr></tHead><tBody>';
                $.each(JSON.parse(data), function (i, inventory) {
                    html += '<tr>' + 
                            '<td>' + inventory.idBook + '</td>' +
                            '<td>' + inventory.nameBook + '</td>' +
                            '<td>' + inventory.oldInventory + '</td>' +
                            '<td>' + inventory.quantityEntry + '</td>' +
                            '<td>' + inventory.quantityOrder + '</td>' +
                            '<td>' + inventory.newInventory + '</td>' +   
                            '</tr>';        
                });
                html += '</tBody></table>';
                $('#show-inventory').fadeOut();
                $('#show-inventory').fadeIn();
                $('#show-inventory').html(html); 
            }
        });
    }
</script>
